<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GiftPrises - NFT Подарки</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #f093fb;
            --text: #ffffff;
            --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .theme-light {
            --primary: #4f46e5;
            --secondary: #7c3aed;
            --accent: #ec4899;
            --text: #1f2937;
            --bg: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .theme-dark {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            --text: #f3f4f6;
            --bg: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            --card-bg: rgba(255, 255, 255, 0.08);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            transition: var(--transition);
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .theme-switcher {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--card-bg);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            color: var(--text);
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            animation: pulse 2s infinite;
        }

        .theme-switcher:hover {
            transform: rotate(180deg) scale(1.1);
            animation: none;
        }

        .logo {
            font-size: 4rem;
            margin-bottom: 10px;
            display: inline-block;
            animation: bounce 2s infinite, glow 3s infinite alternate;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
        }

        .title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textShine 3s ease-in-out infinite;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
            margin-bottom: 30px;
            animation: fadeIn 2s ease-out;
        }

        /* Navigation Grid */
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 30px;
        }

        .nav-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            animation: slideUp 0.6s ease-out;
        }

        .nav-card:nth-child(1) { animation-delay: 0.1s; }
        .nav-card:nth-child(2) { animation-delay: 0.2s; }
        .nav-card:nth-child(3) { animation-delay: 0.3s; }
        .nav-card:nth-child(4) { animation-delay: 0.4s; }
        .nav-card:nth-child(5) { animation-delay: 0.5s; }

        .nav-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .nav-card:hover::before {
            left: 100%;
        }

        .nav-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .nav-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        .nav-card:nth-child(1) .nav-icon { animation-delay: 0s; }
        .nav-card:nth-child(2) .nav-icon { animation-delay: 0.5s; }
        .nav-card:nth-child(3) .nav-icon { animation-delay: 1s; }
        .nav-card:nth-child(4) .nav-icon { animation-delay: 1.5s; }
        .nav-card:nth-child(5) .nav-icon { animation-delay: 2s; }

        .nav-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .nav-desc {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        /* Statistics Dashboard */
        .stats-dashboard {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideUp 0.8s ease-out;
        }

        .stats-dashboard h3 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent);
            font-size: 1.3rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 5px;
            animation: countUp 1s ease-out;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .user-list, .gift-list {
            max-height: 120px;
            overflow-y: auto;
        }

        .user-item, .gift-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 5px;
            transition: var(--transition);
        }

        .user-item:hover, .gift-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .user-name, .gift-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-stats, .gift-stats {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* Admin Panel */
        .admin-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .admin-section {
            margin-bottom: 30px;
        }

        .admin-section h3 {
            margin-bottom: 15px;
            color: var(--accent);
        }

        .toggle-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .toggle-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text);
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-btn.disabled {
            background: #ef4444;
            color: white;
        }

        .toggle-btn.enabled {
            background: #10b981;
            color: white;
        }

        /* Sell Gift Screen */
        .sell-form {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: var(--text);
            font-size: 1rem;
        }

        .evaluation-result {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--accent);
        }

        .evaluation-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 10px;
        }

        .evaluation-details {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .screen.active {
            display: block;
        }

        .back-button {
            background: var(--card-bg);
            border: none;
            color: var(--text);
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            animation: slideInLeft 0.5s ease-out;
        }

        .back-button:hover {
            transform: translateX(-5px);
        }

        /* Models Grid */
        .models-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .model-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            animation: zoomIn 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }

        .model-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }

        .model-card:hover::before {
            transform: translateX(100%);
        }

        .model-card:hover {
            transform: translateY(-5px) scale(1.05);
            border-color: var(--accent);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .model-card.selected {
            border-color: var(--accent);
            background: linear-gradient(135deg, var(--card-bg), rgba(255,255,255,0.15));
            animation: pulse 2s infinite;
        }

        .gift-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .model-name {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .model-price {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 5px;
            animation: glow 2s infinite alternate;
        }

        /* Search Screen */
        .search-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            margin: 20px 0;
            animation: slideUp 0.6s ease-out;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: var(--text);
            font-size: 1rem;
            margin-bottom: 15px;
            transition: var(--transition);
            border: 2px solid transparent;
            animation: slideInRight 0.5s ease-out;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(240, 147, 251, 0.3);
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.6);
            animation: pulse 2s infinite;
        }

        .theme-light .search-input::placeholder {
            color: rgba(0,0,0,0.6);
        }

        .budget-slider {
            width: 100%;
            margin: 20px 0;
            animation: slideInLeft 0.5s ease-out;
        }

        .budget-value {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 10px 0;
            animation: countUp 1s ease-out;
        }

        /* Results */
        .results-grid {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .result-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition);
            animation: slideUp 0.5s ease-out;
        }

        .result-card:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .result-model {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .result-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent);
            animation: glow 2s infinite alternate;
        }

        .result-details {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 15px;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .action-btn {
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .action-btn:hover {
            transform: scale(1.05);
            animation: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .action-btn.secondary {
            background: var(--card-bg);
            color: var(--text);
        }

        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .action-btn.disabled-btn {
            background: #6b7280 !important;
            cursor: not-allowed;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        /* Status Messages */
        .status-message {
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }

        .status-success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.5);
        }

        .status-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.5);
        }

        .status-warning {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.5);
        }

        .status-info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.5);
        }

        /* Features */
        .features {
            margin: 30px 0;
        }

        .feature {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            animation: slideUp 0.6s ease-out;
        }

        .feature-icon {
            font-size: 1.5rem;
            margin-right: 15px;
            animation: bounce 2s infinite;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            opacity: 0.6;
            font-size: 0.9rem;
        }

        /* Purchase Flow */
        .purchase-flow {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: var(--card-bg);
            z-index: 1;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .step-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 8px;
            transition: var(--transition);
        }

        .step.active .step-circle {
            background: var(--primary);
            transform: scale(1.1);
        }

        .step-label {
            font-size: 0.8rem;
            text-align: center;
        }

        .payment-info {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .address-box {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            word-break: break-all;
            font-family: monospace;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .copy-btn {
            background: var(--accent);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .copy-btn:hover {
            transform: scale(1.05);
        }

        /* Gift Image */
        .gift-image-large {
            width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 15px;
            margin: 0 auto 20px;
            display: block;
            border: 3px solid rgba(255,255,255,0.2);
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInLeft {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-10px) scale(1.1); }
            60% { transform: translateY(-5px) scale(1.05); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3)); }
            to { filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.6)); }
        }

        @keyframes textShine {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes countUp {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .nav-grid, .models-grid, .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .logo {
                font-size: 3rem;
            }
        }
    </style>
</head>
<body>
    <!-- Главный экран -->
    <div class="container">
        <div class="screen active" id="main-screen">
            <div class="header">
                <button class="theme-switcher" onclick="switchTheme()">
                    <i class="fas fa-palette"></i>
                </button>
                
                <div class="logo">🎁</div>
                <h1 class="title">GiftPrises</h1>
                <p class="subtitle">Твой мир уникальных NFT подарков</p>
            </div>

            <div class="nav-grid">
                <div class="nav-card" onclick="loadRealGifts()" id="catalog-btn">
                    <div class="nav-icon">📚</div>
                    <div class="nav-title">Каталог NFT</div>
                    <div class="nav-desc">Реальные подарки с маркетплейсов</div>
                </div>
                
                <div class="nav-card" onclick="showScreen('search-screen')" id="search-btn">
                    <div class="nav-icon">🔍</div>
                    <div class="nav-title">Поиск</div>
                    <div class="nav-desc">Найди идеальный подарок</div>
                </div>
                
                <div class="nav-card" onclick="showScreen('budget-screen')" id="budget-btn">
                    <div class="nav-icon">💰</div>
                    <div class="nav-title">Бюджет</div>
                    <div class="nav-desc">Установи лимит</div>
                </div>
                
                <div class="nav-card" onclick="showScreen('sell-screen')" id="sell-btn">
                    <div class="nav-icon">💎</div>
                    <div class="nav-title">Продать подарок</div>
                    <div class="nav-desc">Оцени и продай свой NFT</div>
                </div>

                <!-- Админ панель (временно доступна всем) -->
                <div class="nav-card" onclick="showScreen('admin-screen')" id="admin-btn">
                    <div class="nav-icon">⚙️</div>
                    <div class="nav-title">Админ панель</div>
                    <div class="nav-desc">Управление ботом</div>
                </div>
            </div>

            <!-- Статистика на главной странице -->
            <div class="stats-dashboard">
                <h3>📊 Статистика в реальном времени</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-users">0</div>
                        <div class="stat-label">Всего пользователей</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="today-online">0</div>
                        <div class="stat-label">Сегодня онлайн</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="daily-turnover">0 TON</div>
                        <div class="stat-label">Оборот за день</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="gifts-sold">0</div>
                        <div class="stat-label">Подарков куплено</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <h4 style="margin-bottom: 10px; color: var(--accent);">🏆 Топ покупателей</h4>
                        <div class="user-list" id="top-buyers">
                            <!-- Топ покупателей будет загружен -->
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 10px; color: var(--accent);">🔥 Популярные подарки</h4>
                        <div class="gift-list" id="popular-gifts">
                            <!-- Популярные подарки будут загружены -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="features">
                <div class="feature">
                    <span class="feature-icon">⚡</span>
                    Мгновенная доставка NFT подарков в Telegram
                </div>
                <div class="feature">
                    <span class="feature-icon">🎨</span>
                    Реальные NFT с маркетплейсов по лучшим ценам
                </div>
                <div class="feature">
                    <span class="feature-icon">💫</span>
                    Продажа и оценка ваших NFT подарков
                </div>
                <div class="feature">
                    <span class="feature-icon">🛡️</span>
                    Безопасные сделки через TON блокчейн
                </div>
            </div>

            <div class="footer">
                Powered by Telegram WebApp • GiftPrises 2024
            </div>
        </div>

        <!-- Админ панель -->
        <div class="screen" id="admin-screen">
            <button class="back-button" onclick="showScreen('main-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">⚙️ Админ панель</h2>
            
            <div class="admin-panel">
                <div class="admin-section">
                    <h3>📊 Статистика</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="admin-total-users">0</div>
                            <div class="stat-label">Всего пользователей</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-total-sales">0</div>
                            <div class="stat-label">Всего продаж</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-total-revenue">0 TON</div>
                            <div class="stat-label">Общий доход</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-active-users">0</div>
                            <div class="stat-label">Активных сегодня</div>
                        </div>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>🏆 Топ покупателей</h3>
                    <div class="user-list" id="admin-top-users">
                        <!-- Список топ пользователей -->
                    </div>
                </div>

                <div class="admin-section">
                    <h3>🔧 Управление кнопками</h3>
                    <div class="toggle-buttons">
                        <button class="toggle-btn enabled" id="toggle-search" onclick="toggleButton('search')">
                            Поиск подарков ✅
                        </button>
                        <button class="toggle-btn enabled" id="toggle-budget" onclick="toggleButton('budget')">
                            Поиск по бюджету ✅
                        </button>
                        <button class="toggle-btn enabled" id="toggle-sell" onclick="toggleButton('sell')">
                            Продажа подарков ✅
                        </button>
                        <button class="toggle-btn enabled" id="toggle-catalog" onclick="toggleButton('catalog')">
                            Каталог ✅
                        </button>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>📈 Финансы</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="admin-today-revenue">0 TON</div>
                            <div class="stat-label">Доход за сегодня</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-week-revenue">0 TON</div>
                            <div class="stat-label">Доход за неделю</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Экран продажи подарков -->
        <div class="screen" id="sell-screen">
            <button class="back-button" onclick="showScreen('main-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">💎 Продать NFT подарок</h2>
            
            <div class="sell-form">
                <div class="form-group">
                    <label class="form-label">🔗 Подключите ваш Telegram аккаунт</label>
                    <button class="action-btn" onclick="connectTelegramAccount()" style="width: 100%;">
                        📱 Подключить аккаунт
                    </button>
                </div>

                <div class="form-group">
                    <label class="form-label">🎁 Выберите подарок для оценки</label>
                    <select class="form-select" id="gift-select">
                        <option value="">-- Выберите подарок --</option>
                        <!-- Список подарков будет загружен -->
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">🎨 Модель подарка</label>
                    <input type="text" class="search-input" placeholder="Введите модель подарка..." id="gift-model">
                </div>

                <div class="form-group">
                    <label class="form-label">💰 Ваша цена (TON)</label>
                    <input type="number" class="search-input" placeholder="Введите цену в TON..." id="gift-price">
                </div>

                <button class="action-btn" onclick="evaluateGift()" style="width: 100%;">
                    📊 Оценить подарок
                </button>

                <div id="evaluation-result" style="display: none;">
                    <!-- Результат оценки будет показан здесь -->
                </div>
            </div>
        </div>

        <!-- Экран поиска -->
        <div class="screen" id="search-screen">
            <button class="back-button" onclick="showScreen('main-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">🔍 Поиск подарков</h2>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Введите название подарка..." id="search-input">
                
                <div style="text-align: center; margin: 20px 0;">
                    <div class="budget-value" id="budget-display">Бюджет: 100 TON</div>
                    <input type="range" min="1" max="100000" value="100" class="budget-slider" id="budget-slider" oninput="updateBudgetDisplay(this.value)">
                </div>

                <button class="action-btn" onclick="searchGifts()" style="width: 100%;">
                    🔍 Найти подарки
                </button>

                <div class="loading" id="search-loading">
                    <div class="spinner"></div>
                    <p>Ищем лучшие предложения...</p>
                </div>

                <div id="search-results">
                    <!-- Результаты поиска будут показаны здесь -->
                </div>
            </div>
        </div>

        <!-- Экран каталога -->
        <div class="screen" id="catalog-screen">
            <button class="back-button" onclick="showScreen('main-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">📚 Каталог NFT подарков</h2>
            
            <div class="loading" id="catalog-loading">
                <div class="spinner"></div>
                <p>Загружаем актуальные цены с маркетплейсов...</p>
            </div>

            <div id="catalog-content" style="display: none;">
                <div class="models-grid" id="gift-models">
                    <!-- Модели подарков будут загружены здесь -->
                </div>
            </div>
        </div>

        <!-- Экран покупки -->
        <div class="screen" id="purchase-screen">
            <button class="back-button" onclick="showScreen('catalog-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">🛒 Оформление заказа</h2>
            
            <div class="purchase-flow">
                <div class="step-indicator">
                    <div class="step active">
                        <div class="step-circle">1</div>
                        <div class="step-label">Выбор</div>
                    </div>
                    <div class="step">
                        <div class="step-circle">2</div>
                        <div class="step-label">Оплата</div>
                    </div>
                    <div class="step">
                        <div class="step-circle">3</div>
                        <div class="step-label">Получение</div>
                    </div>
                </div>

                <div id="purchase-content">
                    <!-- Содержимое покупки будет загружено здесь -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Инициализация Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // Инициализация темы
        let currentTheme = 'dark';
        let userData = {
            id: tg.initDataUnsafe?.user?.id || Math.floor(Math.random() * 1000000),
            username: tg.initDataUnsafe?.user?.username || 'user_' + Math.floor(Math.random() * 10000),
            first_name: tg.initDataUnsafe?.user?.first_name || 'Пользователь'
        };
        
        // База данных в localStorage
        let database = {
            users: JSON.parse(localStorage.getItem('giftPrisesUsers')) || {},
            gifts: JSON.parse(localStorage.getItem('giftPrisesGifts')) || {},
            purchases: JSON.parse(localStorage.getItem('giftPrisesPurchases')) || [],
            settings: JSON.parse(localStorage.getItem('giftPrisesSettings')) || {
                searchEnabled: true,
                budgetEnabled: true,
                sellEnabled: true,
                catalogEnabled: true
            }
        };
        
        // Список всех подарков
        const ALL_GIFTS = [
            "Artisan Brick", "Astral Shard", "B-Day Candle", "Berry Box", "Big Year",
            "Bonded Ring", "Bow Tie", "Bunny Milffin", "Candy Cane", "Clover Pin",
            "Cookie Heart", "Crystal Ball", "Cupid Charm", "Desk Calendar", "Diamond Ring",
            "Durov's Cap", "Easter Egg", "Electric Skull", "Eternal Candle", "Eternal Rose",
            "Evil Eye", "Flying Broom", "Fresh Socks", "Gem Signet", "Genie Lamp",
            "Ginger Cookie", "Hanging Star", "Heart Locket", "Heroic Helmet", "Hex Pot",
            "Holiday Drink", "Homemade Cake", "Hypno Lollipop", "Input Key", "Ion Gem",
            "Ionic Dryer", "Jack-in-the-Box", "Jelly Bunny", "Jester Hat", "Jingle Bells",
            "Jolly Chimp", "Joyful Bundle", "Kissed Frog", "Light Sword", "Lol Pop",
            "Loot Bag", "Love Candle", "Love Potion", "Low Rider", "Lunar Snake",
            "Lush Bouquet", "Mad Pumpkin", "Magic Potion", "Mighty Arm", "Mini Oscar",
            "Moon Pandante", "Nail Bracelet", "Neko Helmet", "Party Sparkler", "Perfume Bottle",
            "Pet Snake", "Plush Pepe", "Precious Peach", "Record Player", "Restless Jar",
            "Sakura Flower", "Santa Hat", "Scared Cat", "Sharp Tongue", "Signet Ring",
            "Skull Flower", "Sky Stilettos", "Sleigh Bell", "Snake Box", "Snoop Cigar",
            "Snoop Dogg", "Snow Globe", "Snow Mittens", "Spiced Wine", "Spy Agaric",
            "Star Notepad", "Stellar Rocket", "Swag Bag", "Swiss Watch", "Tama Gadget",
            "Top Hat", "Toy Bear", "Trapped Heart", "Valentine Box", "Vintage Cigar",
            "Voodoo Doll", "Westside Sign", "Whip Cupcake", "Winter Weath", "Witch Hat",
            "Xmas Strocking"
        ];
        
        // Инициализация пользователя
        function initUser() {
            if (!database.users[userData.id]) {
                database.users[userData.id] = {
                    id: userData.id,
                    username: userData.username,
                    firstName: userData.first_name,
                    totalSpent: 0,
                    purchasesCount: 0,
                    lastActivity: new Date().toISOString(),
                    firstSeen: new Date().toISOString()
                };
                saveDatabase();
            } else {
                database.users[userData.id].lastActivity = new Date().toISOString();
                saveDatabase();
            }
            
            updateStatistics();
        }
        
        // Сохранение базы данных
        function saveDatabase() {
            localStorage.setItem('giftPrisesUsers', JSON.stringify(database.users));
            localStorage.setItem('giftPrisesGifts', JSON.stringify(database.gifts));
            localStorage.setItem('giftPrisesPurchases', JSON.stringify(database.purchases));
            localStorage.setItem('giftPrisesSettings', JSON.stringify(database.settings));
        }
        
        // Обновление статистики
        function updateStatistics() {
            const now = new Date();
            const today = now.toISOString().split('T')[0];
            
            // Подсчет пользователей (уникальных)
            const totalUsers = Object.keys(database.users).length;
            
            // Подсчет активных пользователей за сегодня
            const todayUsers = Object.values(database.users).filter(user => 
                user.lastActivity.split('T')[0] === today
            ).length;
            
            // Подсчет продаж за сегодня
            const todayPurchases = database.purchases.filter(purchase => 
                purchase.date.split('T')[0] === today
            );
            const dailyTurnover = todayPurchases.reduce((sum, purchase) => sum + purchase.price, 0);
            const totalGiftsSold = database.purchases.length;
            
            // Обновление отображения
            document.getElementById('total-users').textContent = totalUsers;
            document.getElementById('today-online').textContent = todayUsers;
            document.getElementById('daily-turnover').textContent = dailyTurnover.toFixed(2) + ' TON';
            document.getElementById('gifts-sold').textContent = totalGiftsSold;
            
            // Топ покупателей
            const topBuyers = Object.values(database.users)
                .sort((a, b) => b.totalSpent - a.totalSpent)
                .slice(0, 5);
            
            const topBuyersList = document.getElementById('top-buyers');
            topBuyersList.innerHTML = '';
            topBuyers.forEach((user, index) => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <div class="user-name">${user.firstName}</div>
                    <div class="user-stats">${user.totalSpent.toFixed(2)} TON</div>
                `;
                topBuyersList.appendChild(userItem);
            });
            
            // Популярные подарки
            const giftCounts = {};
            database.purchases.forEach(purchase => {
                giftCounts[purchase.giftName] = (giftCounts[purchase.giftName] || 0) + 1;
            });
            
            const popularGifts = Object.entries(giftCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            const popularGiftsList = document.getElementById('popular-gifts');
            popularGiftsList.innerHTML = '';
            popularGifts.forEach(([giftName, count]) => {
                const giftItem = document.createElement('div');
                giftItem.className = 'gift-item';
                giftItem.innerHTML = `
                    <div class="gift-name">${giftName}</div>
                    <div class="gift-stats">${count} шт</div>
                `;
                popularGiftsList.appendChild(giftItem);
            });
            
            // Обновление админ статистики
            updateAdminStatistics();
        }
        
        // Обновление админ статистики
        function updateAdminStatistics() {
            const totalRevenue = database.purchases.reduce((sum, purchase) => sum + purchase.price, 0);
            const today = new Date().toISOString().split('T')[0];
            const todayRevenue = database.purchases
                .filter(p => p.date.split('T')[0] === today)
                .reduce((sum, p) => sum + p.price, 0);
            
            document.getElementById('admin-total-users').textContent = Object.keys(database.users).length;
            document.getElementById('admin-total-sales').textContent = database.purchases.length;
            document.getElementById('admin-total-revenue').textContent = totalRevenue.toFixed(2) + ' TON';
            document.getElementById('admin-active-users').textContent = Object.values(database.users)
                .filter(u => u.lastActivity.split('T')[0] === today).length;
            document.getElementById('admin-today-revenue').textContent = todayRevenue.toFixed(2) + ' TON';
            
            // Недельный доход (упрощенный расчет)
            document.getElementById('admin-week-revenue').textContent = (todayRevenue * 7).toFixed(2) + ' TON';
            
            // Топ пользователей для админа
            const adminTopUsers = Object.values(database.users)
                .sort((a, b) => b.totalSpent - a.totalSpent)
                .slice(0, 10);
            
            const adminTopUsersList = document.getElementById('admin-top-users');
            adminTopUsersList.innerHTML = '';
            adminTopUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <div class="user-name">${user.firstName}</div>
                    <div class="user-stats">${user.totalSpent.toFixed(2)} TON</div>
                `;
                adminTopUsersList.appendChild(userItem);
            });
        }
        
        // Переключение темы
        function switchTheme() {
            const themes = ['dark', 'light'];
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            currentTheme = themes[nextIndex];
            
            document.body.className = `theme-${currentTheme}`;
            
            // Анимация переключения темы
            const switcher = document.querySelector('.theme-switcher');
            switcher.style.transform = 'rotate(360deg)';
            setTimeout(() => {
                switcher.style.transform = '';
            }, 500);
        }
        
        // Показать экран
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
            
            // Обновить статистику при показе главного экрана
            if (screenId === 'main-screen') {
                updateStatistics();
            }
        }
        
        // Обновление отображения бюджета
        function updateBudgetDisplay(value) {
            document.getElementById('budget-display').textContent = `Бюджет: ${value} TON`;
        }
        
        // Переключение кнопок в админ панели
        function toggleButton(buttonType) {
            const button = document.getElementById(`toggle-${buttonType}`);
            const navButton = document.getElementById(`${buttonType}-btn`);
            
            if (database.settings[`${buttonType}Enabled`]) {
                database.settings[`${buttonType}Enabled`] = false;
                button.textContent = `${getButtonName(buttonType)} ❌`;
                button.className = 'toggle-btn disabled';
                navButton.style.opacity = '0.5';
                navButton.style.pointerEvents = 'none';
            } else {
                database.settings[`${buttonType}Enabled`] = true;
                button.textContent = `${getButtonName(buttonType)} ✅`;
                button.className = 'toggle-btn enabled';
                navButton.style.opacity = '1';
                navButton.style.pointerEvents = 'auto';
            }
            
            saveDatabase();
        }
        
        function getButtonName(type) {
            const names = {
                'search': 'Поиск подарков',
                'budget': 'Поиск по бюджету',
                'sell': 'Продажа подарков',
                'catalog': 'Каталог'
            };
            return names[type] || type;
        }
        
        // Поиск подарков
        function searchGifts() {
            const budget = parseInt(document.getElementById('budget-slider').value);
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            
            const loading = document.getElementById('search-loading');
            const results = document.getElementById('search-results');
            
            loading.style.display = 'block';
            results.innerHTML = '';
            
            // Имитация поиска через API
            setTimeout(() => {
                loading.style.display = 'none';
                
                // Генерация результатов поиска из реальных подарков
                const searchResults = generateSearchResults(budget, searchTerm);
                
                if (searchResults.length === 0) {
                    results.innerHTML = `
                        <div class="status-message status-warning">
                            😔 По вашему запросу ничего не найдено. Попробуйте изменить бюджет или критерии поиска.
                        </div>
                    `;
                    return;
                }
                
                searchResults.forEach(result => {
                    const resultCard = document.createElement('div');
                    resultCard.className = 'result-card';
                    resultCard.innerHTML = `
                        <div class="result-header">
                            <div class="result-model">${result.name}</div>
                            <div class="result-price">${result.price} TON</div>
                        </div>
                        <div class="result-details">
                            ${result.description}
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn" onclick="purchaseGift('${result.name}', ${result.price})">
                                🛒 Купить
                            </button>
                            <button class="action-btn secondary" onclick="addToFavorites('${result.name}')">
                                ❤️ В избранное
                            </button>
                        </div>
                    `;
                    results.appendChild(resultCard);
                });
            }, 2000);
        }
        
        // Генерация результатов поиска из реальных подарков
        function generateSearchResults(budget, searchTerm) {
            const results = [];
            
            ALL_GIFTS.forEach(giftName => {
                // Проверка соответствия поисковому запросу
                if (searchTerm && !giftName.toLowerCase().includes(searchTerm)) {
                    return;
                }
                
                // Генерация цены (реалистичные цены для разных подарков)
                const basePrice = generateRealisticPrice(giftName);
                const finalPrice = Math.min(basePrice, budget);
                
                if (finalPrice <= budget) {
                    results.push({
                        name: giftName,
                        price: finalPrice,
                        description: getGiftDescription(giftName),
                        image: generateGiftImage(giftName)
                    });
                }
            });
            
            // Сортировка по цене (от дешевых к дорогим)
            return results.sort((a, b) => a.price - b.price).slice(0, 10);
        }
        
        // Генерация реалистичной цены для подарка
        function generateRealisticPrice(giftName) {
            // Базовые цены в зависимости от редкости подарка
            const priceRanges = {
                common: { min: 50, max: 500 },
                rare: { min: 500, max: 2000 },
                epic: { min: 2000, max: 10000 },
                legendary: { min: 10000, max: 50000 }
            };
            
            // Определение редкости подарка
            let rarity = 'common';
            if (giftName.includes('Diamond') || giftName.includes('Golden') || giftName.includes('Eternal')) {
                rarity = 'legendary';
            } else if (giftName.includes('Crystal') || giftName.includes('Magic') || giftName.includes('Heroic')) {
                rarity = 'epic';
            } else if (giftName.includes('Silver') || giftName.includes('Gem') || giftName.includes('Star')) {
                rarity = 'rare';
            }
            
            const range = priceRanges[rarity];
            return Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
        }
        
        // Получение описания подарка
        function getGiftDescription(giftName) {
            const descriptions = {
                "Plush Pepe": "Мягкая игрушка Pepe с ограниченным тиражом",
                "Diamond Ring": "Роскошное бриллиантовое кольцо в метавселенной",
                "Eternal Rose": "Вечная роза, которая никогда не завянет",
                "Magic Potion": "Волшебное зелье с магическими свойствами",
                "Crystal Ball": "Хрустальный шар для предсказания будущего",
                "Heroic Helmet": "Шлем настоящего героя с защитными свойствами"
            };
            
            return descriptions[giftName] || `Эксклюзивный NFT подарок "${giftName}" с уникальными характеристиками`;
        }
        
        // Генерация изображения подарка
        function generateGiftImage(giftName) {
            const colors = ['667eea', '764ba2', 'f093fb', 'f5576c', '4facfe', '00cdac'];
            const color = colors[giftName.length % colors.length];
            return `https://via.placeholder.com/150/${color}/ffffff?text=${encodeURIComponent(giftName.substring(0, 8))}`;
        }
        
        // Загрузка реальных подарков через API
        function loadRealGifts() {
            if (!database.settings.catalogEnabled) {
                showNotification('Каталог временно отключен администратором', 'warning');
                return;
            }
            
            showScreen('catalog-screen');
            
            const loading = document.getElementById('catalog-loading');
            const content = document.getElementById('catalog-content');
            const modelsGrid = document.getElementById('gift-models');
            
            loading.style.display = 'block';
            content.style.display = 'none';
            modelsGrid.innerHTML = '';
            
            // Имитация загрузки данных через API
            setTimeout(() => {
                loading.style.display = 'none';
                content.style.display = 'block';
                
                const catalogGifts = generateCatalogGifts();
                
                catalogGifts.forEach(gift => {
                    const modelCard = document.createElement('div');
                    modelCard.className = 'model-card';
                    modelCard.onclick = () => showGiftDetails(gift);
                    modelCard.innerHTML = `
                        <img src="${gift.image}" class="gift-image" alt="${gift.name}">
                        <div class="model-name">${gift.name}</div>
                        <div class="model-price">${gift.price} TON</div>
                    `;
                    modelsGrid.appendChild(modelCard);
                });
            }, 3000);
        }
        
        // Генерация подарков для каталога
        function generateCatalogGifts() {
            return ALL_GIFTS.slice(0, 20).map(giftName => ({
                name: giftName,
                price: generateRealisticPrice(giftName),
                image: generateGiftImage(giftName),
                description: getGiftDescription(giftName),
                marketUrl: "https://getgems.io/collection/gifts"
            }));
        }
        
        // Показать детали подарка
        function showGiftDetails(gift) {
            showScreen('purchase-screen');
            
            const purchaseContent = document.getElementById('purchase-content');
            purchaseContent.innerHTML = `
                <div style="text-align: center;">
                    <img src="${gift.image}" class="gift-image-large" alt="${gift.name}">
                    <h3 style="margin-bottom: 10px;">${gift.name}</h3>
                    <div class="result-price" style="margin-bottom: 15px;">${gift.price} TON</div>
                    <p style="margin-bottom: 20px; opacity: 0.8;">${gift.description}</p>
                    
                    <div class="payment-info">
                        <h4 style="margin-bottom: 10px;">💳 Способ оплаты</h4>
                        <p style="margin-bottom: 15px;">Оплата через TON кошелек</p>
                        
                        <div class="address-box">
                            EQCD39VS5jcptHL8vMjEXrzGaRcCVYto7HUn4bpAOg8xqB2N
                        </div>
                        
                        <button class="copy-btn" onclick="copyAddress()">
                            📋 Скопировать адрес
                        </button>
                    </div>
                    
                    <button class="action-btn" onclick="completePurchase('${gift.name}', ${gift.price})" style="width: 100%; margin-top: 20px;">
                        ✅ Подтвердить покупку
                    </button>
                </div>
            `;
        }
        
        // Покупка подарка
        function purchaseGift(giftName, price) {
            // Обновление статистики пользователя
            database.users[userData.id].totalSpent += price;
            database.users[userData.id].purchasesCount += 1;
            
            // Добавление покупки в историю
            database.purchases.push({
                userId: userData.id,
                giftName: giftName,
                price: price,
                date: new Date().toISOString()
            });
            
            saveDatabase();
            updateStatistics();
            
            showNotification(`🎉 Поздравляем! Вы успешно приобрели ${giftName} за ${price} TON`, 'success');
            showScreen('main-screen');
        }
        
        // Завершение покупки
        function completePurchase(giftName, price) {
            purchaseGift(giftName, price);
        }
        
        // Копирование адреса
        function copyAddress() {
            navigator.clipboard.writeText("EQCD39VS5jcptHL8vMjEXrzGaRcCVYto7HUn4bpAOg8xqB2N")
                .then(() => showNotification('Адрес скопирован в буфер обмена', 'success'))
                .catch(() => showNotification('Ошибка копирования', 'error'));
        }
        
        // Подключение Telegram аккаунта
        function connectTelegramAccount() {
            showNotification('📱 Функция подключения аккаунта в разработке', 'info');
        }
        
        // Оценка подарка
        function evaluateGift() {
            const model = document.getElementById('gift-model').value;
            const price = parseFloat(document.getElementById('gift-price').value);
            
            if (!model || !price) {
                showNotification('❌ Заполните все поля', 'error');
                return;
            }
            
            // Имитация оценки через API
            const evaluationResult = document.getElementById('evaluation-result');
            evaluationResult.style.display = 'block';
            evaluationResult.innerHTML = `
                <div class="evaluation-result">
                    <div class="evaluation-price">Рекомендуемая цена: ${(price * 0.9).toFixed(2)} TON</div>
                    <div class="evaluation-details">
                        <p>📊 Ваш подарок оценен на ${(price * 0.9).toFixed(2)} TON</p>
                        <p>💡 Совет: Установите цену на 10-15% ниже рыночной для быстрой продажи</p>
                        <p>🕒 Среднее время продажи: 2-5 дней</p>
                    </div>
                    <button class="action-btn" onclick="listGiftForSale('${model}', ${price * 0.9})" style="width: 100%; margin-top: 15px;">
                        📈 Выставить на продажу
                    </button>
                </div>
            `;
        }
        
        // Выставление подарка на продажу
        function listGiftForSale(model, price) {
            showNotification(`🎁 Подарок "${model}" выставлен на продажу за ${price.toFixed(2)} TON`, 'success');
            showScreen('main-screen');
        }
        
        // Добавление в избранное
        function addToFavorites(giftName) {
            showNotification(`❤️ "${giftName}" добавлен в избранное`, 'success');
        }
        
        // Показать уведомление
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `status-message status-${type}`;
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.zIndex = '1000';
            notification.style.maxWidth = '90%';
            notification.style.animation = 'slideUp 0.3s ease-out';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'fadeIn 0.3s ease-out reverse';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            initUser();
            
            // Заполнение списка подарков для продажи
            const giftSelect = document.getElementById('gift-select');
            ALL_GIFTS.forEach(gift => {
                const option = document.createElement('option');
                option.value = gift;
                option.textContent = gift;
                giftSelect.appendChild(option);
            });
            
            // Применение настроек кнопок
            Object.keys(database.settings).forEach(key => {
                if (key.endsWith('Enabled')) {
                    const buttonType = key.replace('Enabled', '');
                    const navButton = document.getElementById(`${buttonType}-btn`);
                    if (navButton) {
                        navButton.style.opacity = database.settings[key] ? '1' : '0.5';
                        navButton.style.pointerEvents = database.settings[key] ? 'auto' : 'none';
                    }
                }
            });
            
            // Отправка данных в Telegram
            tg.ready();
        });
    </script>
</body>
</html>
