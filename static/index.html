<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GiftPrises - NFT Подарки</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #f093fb;
            --text: #ffffff;
            --bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --text-secondary: rgba(255, 255, 255, 0.7);
        }

        [data-theme="light"] {
            --primary: #4f46e5;
            --secondary: #7c3aed;
            --accent: #ec4899;
            --text: #1f2937;
            --bg: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 100%);
            --card-bg: rgba(255, 255, 255, 0.95);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            --text-secondary: rgba(0, 0, 0, 0.7);
        }

        [data-theme="dark"] {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            --text: #f3f4f6;
            --bg: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            --card-bg: rgba(255, 255, 255, 0.08);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --text-secondary: rgba(255, 255, 255, 0.7);
        }

        [data-theme="purple"] {
            --primary: #a78bfa;
            --secondary: #7c3aed;
            --accent: #c084fc;
            --text: #1f2937;
            --bg: linear-gradient(135deg, #e9d5ff 0%, #a78bfa 100%);
            --card-bg: rgba(255, 255, 255, 0.9);
            --shadow: 0 8px 32px rgba(167, 139, 250, 0.2);
            --text-secondary: rgba(55, 65, 81, 0.8);
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            transition: var(--transition);
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }

        .theme-switcher {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--card-bg);
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            color: var(--text);
            cursor: pointer;
            backdrop-filter: blur(10px);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .theme-switcher:hover {
            transform: rotate(180deg) scale(1.1);
        }

        .theme-switcher.rotating {
            animation: themeSwitch 0.6s ease-in-out;
        }

        .logo {
            font-size: 4rem;
            margin-bottom: 10px;
            display: inline-block;
            animation: bounce 2s infinite, glow 3s infinite alternate;
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
        }

        .title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textShine 3s ease-in-out infinite;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
            margin-bottom: 30px;
            animation: fadeIn 2s ease-out;
        }

        /* Navigation Grid */
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 30px;
        }

        .nav-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            animation: slideUp 0.6s ease-out;
        }

        .nav-card:nth-child(1) { animation-delay: 0.1s; }
        .nav-card:nth-child(2) { animation-delay: 0.2s; }
        .nav-card:nth-child(3) { animation-delay: 0.3s; }
        .nav-card:nth-child(4) { animation-delay: 0.4s; }
        .nav-card:nth-child(5) { animation-delay: 0.5s; }

        .nav-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.6s;
        }

        .nav-card:hover::before {
            left: 100%;
        }

        .nav-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .nav-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: block;
            animation: float 3s ease-in-out infinite;
        }

        .nav-card:nth-child(1) .nav-icon { animation-delay: 0s; }
        .nav-card:nth-child(2) .nav-icon { animation-delay: 0.5s; }
        .nav-card:nth-child(3) .nav-icon { animation-delay: 1s; }
        .nav-card:nth-child(4) .nav-icon { animation-delay: 1.5s; }
        .nav-card:nth-child(5) .nav-icon { animation-delay: 2s; }

        .nav-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .nav-desc {
            font-size: 0.85rem;
            opacity: 0.7;
        }

        /* Statistics Dashboard */
        .stats-dashboard {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideUp 0.8s ease-out;
        }

        .stats-dashboard h3 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--accent);
            font-size: 1.3rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 5px;
            animation: countUp 1s ease-out;
        }

        .stat-label {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .user-list, .gift-list {
            max-height: 120px;
            overflow-y: auto;
        }

        .user-item, .gift-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 5px;
            transition: var(--transition);
        }

        .user-item:hover, .gift-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .user-rank, .gift-rank {
            font-weight: 600;
            color: var(--accent);
            min-width: 20px;
        }

        .user-name, .gift-name {
            font-weight: 600;
            font-size: 0.9rem;
            flex: 1;
            margin: 0 10px;
        }

        .user-amount, .gift-sales {
            font-size: 0.8rem;
            opacity: 0.7;
        }

        /* Admin Panel */
        .admin-panel {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .admin-section {
            margin-bottom: 30px;
        }

        .admin-section h3 {
            margin-bottom: 15px;
            color: var(--accent);
        }

        .toggle-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .toggle-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: var(--card-bg);
            color: var(--text);
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-btn.disabled {
            background: #ef4444;
            color: white;
        }

        .toggle-btn.enabled {
            background: #10b981;
            color: white;
        }

        /* Gift Cards */
        .gift-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            margin: 15px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition);
        }

        .gift-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .gift-image {
            text-align: center;
            margin-bottom: 15px;
        }

        .gift-image img {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            object-fit: cover;
            border: 2px solid rgba(255,255,255,0.1);
        }

        .gift-info {
            text-align: center;
        }

        .gift-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .gift-price {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .gift-market {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .gift-rarity {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 8px;
            display: inline-block;
            margin-bottom: 15px;
        }

        .gift-rarity.common { background: rgba(255,255,255,0.1); }
        .gift-rarity.rare { background: rgba(59, 130, 246, 0.3); }
        .gift-rarity.epic { background: rgba(168, 85, 247, 0.3); }
        .gift-rarity.legendary { background: rgba(245, 158, 11, 0.3); }

        .buy-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .buy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: var(--text);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            background: rgba(255,255,255,0.15);
            box-shadow: 0 0 0 2px var(--accent);
        }

        .form-hint {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 5px;
        }

        /* Search Screen */
        .search-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(10px);
            margin: 20px 0;
            animation: slideUp 0.6s ease-out;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            background: rgba(255,255,255,0.1);
            color: var(--text);
            font-size: 1rem;
            margin-bottom: 15px;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(240, 147, 251, 0.3);
        }

        .budget-value {
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            margin: 10px 0;
        }

        .budget-slider {
            width: 100%;
            margin: 20px 0;
        }

        .budget-large {
            font-size: 1.1rem;
            color: var(--accent);
            font-weight: 600;
            text-align: center;
            margin: 15px 0;
            padding: 10px;
            background: rgba(240, 147, 251, 0.1);
            border-radius: 10px;
            display: none;
        }

        /* Purchase Screens */
        .purchase-container, .payment-container, .confirmation-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .purchase-form {
            margin-top: 20px;
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.2);
            border: 1px solid rgba(245, 158, 11, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .purchase-summary {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-item.total {
            border-top: 1px solid rgba(255,255,255,0.2);
            padding-top: 10px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .payment-amount {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            text-align: center;
            margin: 20px 0;
        }

        .wallet-address {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            word-break: break-all;
            font-family: monospace;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .payment-steps {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .payment-steps ol {
            margin-left: 20px;
            margin-top: 10px;
        }

        .payment-steps li {
            margin-bottom: 8px;
        }

        .confirmation-icon {
            font-size: 4rem;
            text-align: center;
            margin-bottom: 20px;
        }

        .confirmation-details {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .confirmation-message {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 15px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            font-size: 1rem;
        }

        .action-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .action-btn.secondary {
            background: var(--card-bg);
            color: var(--text);
        }

        /* Back Button */
        .back-button {
            background: var(--card-bg);
            border: none;
            color: var(--text);
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            cursor: pointer;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .back-button:hover {
            transform: translateX(-5px);
        }

        /* Loading and Messages */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1rem;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            opacity: 0.7;
            font-size: 1.1rem;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            max-width: 300px;
            animation: slideInRight 0.3s ease-out;
        }

        .notification.success {
            background: var(--success);
            color: white;
        }

        .notification.error {
            background: var(--error);
            color: white;
        }

        .notification.warning {
            background: var(--warning);
            color: white;
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .screen.active {
            display: block;
        }

        /* Features */
        .features {
            margin: 30px 0;
        }

        .feature {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 12px;
            backdrop-filter: blur(10px);
            animation: slideUp 0.6s ease-out;
        }

        .feature-icon {
            font-size: 1.5rem;
            margin-right: 15px;
            animation: bounce 2s infinite;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            opacity: 0.6;
            font-size: 0.9rem;
        }

        /* Admin User List */
        .admin-user-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 10px;
        }

        .admin-user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .admin-user-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .admin-user-item.active {
            background: rgba(102, 126, 234, 0.3);
            border: 1px solid var(--primary);
        }

        .user-search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .user-search-input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: var(--text);
            font-size: 1rem;
        }

        .user-search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .user-detail-stats {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .user-detail-section {
            margin-bottom: 20px;
        }

        .user-detail-section h4 {
            margin-bottom: 10px;
            color: var(--accent);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 5px;
        }

        .user-purchase-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            margin-bottom: 5px;
        }

        .purchase-status.completed {
            color: var(--success);
        }

        .purchase-status.cancelled {
            color: var(--error);
        }

        .purchase-status.pending {
            color: var(--warning);
        }

        .user-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .user-stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .user-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .user-stat-label {
            font-size: 0.75rem;
            opacity: 0.7;
        }

        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes slideOutRight {
            from { opacity: 1; transform: translateX(0); }
            to { opacity: 0; transform: translateX(30px); }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-10px) scale(1.1); }
            60% { transform: translateY(-5px) scale(1.05); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3)); }
            to { filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.6)); }
        }

        @keyframes textShine {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes themeSwitch {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        @keyframes countUp {
            from { opacity: 0; transform: scale(0.5); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .nav-grid, .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .logo {
                font-size: 3rem;
            }
            
            .toggle-buttons {
                grid-template-columns: 1fr;
            }
            
            .user-stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Главный экран -->
        <div class="screen active" id="main-screen">
            <div class="header">
                <button class="theme-switcher" onclick="switchTheme()" id="theme-btn">
                    <i class="fas fa-palette"></i>
                </button>
                
                <div class="logo">🎁</div>
                <h1 class="title">GiftPrises</h1>
                <p class="subtitle">Твой мир уникальных NFT подарков</p>
            </div>

            <div class="nav-grid">
                <div class="nav-card" onclick="loadRealGifts()" id="catalog-btn">
                    <div class="nav-icon">📚</div>
                    <div class="nav-title">Каталог NFT</div>
                    <div class="nav-desc">Реальные подарки с маркетплейсов</div>
                </div>
                
                <div class="nav-card" onclick="showScreen('search-screen')" id="search-btn">
                    <div class="nav-icon">🔍</div>
                    <div class="nav-title">Поиск</div>
                    <div class="nav-desc">Найди идеальный подарок</div>
                </div>
                
                <div class="nav-card" onclick="showScreen('budget-screen')" id="budget-btn">
                    <div class="nav-icon">💰</div>
                    <div class="nav-title">Бюджет</div>
                    <div class="nav-desc">Установи лимит</div>
                </div>
                
                <div class="nav-card" onclick="showScreen('sell-screen')" id="sell-btn">
                    <div class="nav-icon">💎</div>
                    <div class="nav-title">Продать подарок</div>
                    <div class="nav-desc">Оцени и продай свой NFT</div>
                </div>

                <div class="nav-card" onclick="showScreen('admin-screen')" id="admin-btn">
                    <div class="nav-icon">⚙️</div>
                    <div class="nav-title">Админ панель</div>
                    <div class="nav-desc">Управление ботом</div>
                </div>
            </div>

            <!-- Статистика -->
            <div class="stats-dashboard">
                <h3>📊 Статистика в реальном времени</h3>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-users">1,247</div>
                        <div class="stat-label">Всего пользователей</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="today-online">89</div>
                        <div class="stat-label">Сегодня онлайн</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="daily-turnover">2,450 TON</div>
                        <div class="stat-label">Оборот за день</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="gifts-sold">156</div>
                        <div class="stat-label">Подарков куплено</div>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <h4 style="margin-bottom: 10px; color: var(--accent);">🏆 Топ покупателей</h4>
                        <div class="user-list" id="top-buyers">
                            <div class="user-item">
                                <span class="user-rank">1</span>
                                <span class="user-name">@cryptoking</span>
                                <span class="user-amount">1,250 TON</span>
                            </div>
                            <div class="user-item">
                                <span class="user-rank">2</span>
                                <span class="user-name">@tonlover</span>
                                <span class="user-amount">980 TON</span>
                            </div>
                            <div class="user-item">
                                <span class="user-rank">3</span>
                                <span class="user-name">@giftmaster</span>
                                <span class="user-amount">750 TON</span>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="margin-bottom: 10px; color: var(--accent);">🔥 Популярные подарки</h4>
                        <div class="gift-list" id="popular-gifts">
                            <div class="gift-item">
                                <span class="gift-rank">1</span>
                                <span class="gift-name">Golden NFT</span>
                                <span class="gift-sales">45 шт</span>
                            </div>
                            <div class="gift-item">
                                <span class="gift-rank">2</span>
                                <span class="gift-name">Crypto Art</span>
                                <span class="gift-sales">38 шт</span>
                            </div>
                            <div class="gift-item">
                                <span class="gift-rank">3</span>
                                <span class="gift-name">VIP Badge</span>
                                <span class="gift-sales">32 шт</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="features">
                <div class="feature">
                    <span class="feature-icon">⚡</span>
                    Мгновенная доставка NFT подарков в Telegram
                </div>
                <div class="feature">
                    <span class="feature-icon">🎨</span>
                    Реальные NFT с маркетплейсов по лучшим ценам
                </div>
                <div class="feature">
                    <span class="feature-icon">💫</span>
                    Продажа и оценка ваших NFT подарков
                </div>
                <div class="feature">
                    <span class="feature-icon">🛡️</span>
                    Безопасные сделки через TON блокчейн
                </div>
            </div>

            <div class="footer">
                Powered by Telegram WebApp • GiftPrises 2024
            </div>
        </div>

        <!-- Админ панель -->
        <div class="screen" id="admin-screen">
            <button class="back-button" onclick="showScreen('main-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">⚙️ Админ панель</h2>
            
            <div class="admin-panel">
                <div class="admin-section">
                    <h3>📊 Общая статистика</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="admin-total-users">1,247</div>
                            <div class="stat-label">Всего пользователей</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-total-sales">543</div>
                            <div class="stat-label">Всего продаж</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-total-revenue">8,420 TON</div>
                            <div class="stat-label">Общий доход</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="admin-active-users">89</div>
                            <div class="stat-label">Активных сейчас</div>
                        </div>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>🛠️ Управление ботом</h3>
                    <div class="toggle-buttons">
                        <button class="toggle-btn enabled" id="toggle-purchases" onclick="toggleSetting('purchases')">
                            Покупки включены
                        </button>
                        <button class="toggle-btn enabled" id="toggle-sales" onclick="toggleSetting('sales')">
                            Продажи включены
                        </button>
                        <button class="toggle-btn enabled" id="toggle-withdrawals" onclick="toggleSetting('withdrawals')">
                            Вывод включен
                        </button>
                        <button class="toggle-btn enabled" id="toggle-support" onclick="toggleSetting('support')">
                            Поддержка онлайн
                        </button>
                    </div>
                </div>

                <div class="admin-section">
                    <h3>👥 Управление пользователями</h3>
                    
                    <div class="user-search-container">
                        <input type="text" class="user-search-input" id="user-search" placeholder="Поиск пользователя по юзернейму...">
                        <i class="fas fa-search user-search-icon"></i>
                    </div>
                    
                    <div class="admin-user-list" id="admin-user-list">
                        <!-- Список пользователей будет загружен здесь -->
                    </div>
                    
                    <div class="user-detail-stats" id="user-detail-stats" style="display: none;">
                        <h4>📈 Статистика пользователя: <span id="selected-username"></span></h4>
                        
                        <div class="user-detail-section">
                            <h4>💳 Финансовая статистика</h4>
                            <div class="user-stats-grid">
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-total-spent">0 TON</div>
                                    <div class="user-stat-label">Всего потрачено</div>
                                </div>
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-successful-payments">0</div>
                                    <div class="user-stat-label">Успешных платежей</div>
                                </div>
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-failed-payments">0</div>
                                    <div class="user-stat-label">Неудачных платежей</div>
                                </div>
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-refund-amount">0 TON</div>
                                    <div class="user-stat-label">Сумма возвратов</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="user-detail-section">
                            <h4>🎁 Статистика подарков</h4>
                            <div class="user-stats-grid">
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-gifts-purchased">0</div>
                                    <div class="user-stat-label">Куплено подарков</div>
                                </div>
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-top-gift">-</div>
                                    <div class="user-stat-label">Любимый подарок</div>
                                </div>
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-avg-gift-price">0 TON</div>
                                    <div class="user-stat-label">Средний чек</div>
                                </div>
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-gifts-sent">0</div>
                                    <div class="user-stat-label">Подарков отправлено</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="user-detail-section">
                            <h4>⏱️ Активность</h4>
                            <div class="user-stats-grid">
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-hours-spent">0 ч</div>
                                    <div class="user-stat-label">Время в боте</div>
                                </div>
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-sessions-count">0</div>
                                    <div class="user-stat-label">Сессий в боте</div>
                                </div>
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-support-requests">0</div>
                                    <div class="user-stat-label">Обращений в поддержку</div>
                                </div>
                                <div class="user-stat-card">
                                    <div class="user-stat-value" id="user-days-active">0</div>
                                    <div class="user-stat-label">Дней активности</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="user-detail-section">
                            <h4>📋 История покупок</h4>
                            <div id="user-purchase-history">
                                <!-- История покупок будет загружена здесь -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Экран продажи подарков -->
        <div class="screen" id="sell-screen">
            <button class="back-button" onclick="showScreen('main-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">💎 Продать NFT подарок</h2>
            
            <div class="search-container">
                <div class="form-group">
                    <label class="form-label">🔗 Подключите ваш Telegram аккаунт</label>
                    <button class="action-btn" onclick="connectTelegramAccount()" style="width: 100%;">
                        📱 Подключить аккаунт
                    </button>
                </div>

                <div class="form-group">
                    <label class="form-label">🎁 Выберите подарок для оценки</label>
                    <select class="form-select" id="gift-select">
                        <option value="">-- Выберите подарок --</option>
                        <option value="golden-nft">Golden NFT</option>
                        <option value="crypto-art">Crypto Art</option>
                        <option value="vip-badge">VIP Badge</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">🎨 Модель подарка</label>
                    <input type="text" class="form-input" placeholder="Название модели" id="gift-model">
                </div>

                <div class="form-group">
                    <label class="form-label">🌄 Фон</label>
                    <select class="form-select" id="gift-backdrop">
                        <option value="">Любой фон</option>
                        <option value="Звездный">Звездный</option>
                        <option value="Городской">Городской</option>
                        <option value="Природный">Природный</option>
                        <option value="Абстрактный">Абстрактный</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">✨ Узор</label>
                    <select class="form-select" id="gift-symbol">
                        <option value="">Любой узор</option>
                        <option value="Звезды">Звезды</option>
                        <option value="Цветы">Цветы</option>
                        <option value="Геометрия">Геометрия</option>
                        <option value="Полосы">Полосы</option>
                    </select>
                </div>

                <button class="action-btn" onclick="evaluateGift()" style="width: 100%;">
                    💰 Оценить подарок
                </button>

                <div id="evaluation-result" style="display: none;"></div>
            </div>
        </div>

        <!-- Экран каталога -->
        <div class="screen" id="catalog-screen">
            <button class="back-button" onclick="showScreen('main-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">📚 Каталог NFT Подарков</h2>
            
            <div id="catalog-content">
                <div class="loading">🔄 Загрузка каталога...</div>
            </div>
        </div>

        <!-- Экран поиска -->
        <div class="screen" id="search-screen">
            <button class="back-button" onclick="showScreen('main-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">🔍 Поиск NFT подарков</h2>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="🎭 Введите название модели..." id="search-input">
                <input type="text" class="search-input" placeholder="🌄 Введите фон (опционально)..." id="backdrop-input">
                <input type="text" class="search-input" placeholder="✨ Введите узор (опционально)..." id="symbol-input">
                
                <div class="budget-value">💰 Бюджет: <span id="budget-amount">50</span> TON</div>
                <input type="range" class="budget-slider" min="1" max="100000" value="50" id="budget-slider">
                
                <div class="budget-large" id="large-budget" style="display: none;">
                    🚀 Премиум бюджет! Будем искать лучшие предложения
                </div>
                
                <button class="action-btn" onclick="performSearch()" style="width: 100%;">
                    🔍 Найти NFT подарки
                </button>

                <button class="action-btn secondary" onclick="clearSearch()" style="width: 100%; margin-top: 10px;">
                    🗑️ Очистить поиск
                </button>
            </div>

            <div id="search-results">
                <div class="loading">🔍 Введите параметры поиска...</div>
            </div>
        </div>

        <!-- Экран бюджета -->
        <div class="screen" id="budget-screen">
            <button class="back-button" onclick="showScreen('main-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">💰 Установи бюджет</h2>
            
            <div class="search-container">
                <div class="budget-value" style="font-size: 2rem; color: var(--accent);">
                    <span id="budget-display">50</span> TON
                </div>
                <input type="range" class="budget-slider" min="1" max="100000" value="50" id="budget-setter">
                
                <div class="budget-large" id="budget-large-display" style="display: none;">
                    💎 Премиум режим активирован!
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 20px;">
                    <button class="action-btn secondary" onclick="setBudget(30)">30 TON</button>
                    <button class="action-btn secondary" onclick="setBudget(100)">100 TON</button>
                    <button class="action-btn secondary" onclick="setBudget(1000)">1000 TON</button>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px;">
                    <button class="action-btn secondary" onclick="setBudget(10000)">10,000 TON</button>
                    <button class="action-btn secondary" onclick="setBudget(50000)">50,000 TON</button>
                </div>
                
                <button class="action-btn" onclick="saveBudget()" style="width: 100%; margin-top: 20px;">
                    💾 Сохранить бюджет
                </button>
            </div>
        </div>

        <!-- Экран покупки -->
        <div class="screen" id="purchase-screen">
            <button class="back-button" onclick="showScreen('main-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">🛒 Оформление покупки</h2>
            
            <div class="purchase-container">
                <div class="gift-card" id="purchase-gift-card">
                    <!-- Карточка выбранного подарка -->
                </div>
                
                <div class="purchase-form">
                    <div class="form-group">
                        <label class="form-label">👤 Ваш Telegram юзернейм</label>
                        <input type="text" class="form-input" placeholder="@username" id="username-input">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">💼 Ваш TON кошелек</label>
                        <input type="text" class="form-input" placeholder="UQ... или EQC..." id="wallet-input">
                        <div class="form-hint">
                            Как найти кошелек: 
                            <br>• @Wallet - Настройки → Кошелек → Адрес
                            <br>• @CryptoBot - Кошелек → TON → Получить → Адрес
                        </div>
                    </div>
                    
                    <div class="warning-box">
                        ⚠️ Внимание! При неверном указании кошелька или юзернейма 
                        бот не сможет отправить вам подарок!
                    </div>
                    
                    <div class="purchase-summary">
                        <div class="summary-item">
                            <span>Стоимость подарка:</span>
                            <span id="summary-price">0 TON</span>
                        </div>
                        <div class="summary-item">
                            <span>Комиссия (5%):</span>
                            <span id="summary-fee">0 TON</span>
                        </div>
                        <div class="summary-item total">
                            <span>Итого к оплате:</span>
                            <span id="summary-total">0 TON</span>
                        </div>
                    </div>
                    
                    <button class="action-btn" onclick="confirmPurchase()" style="width: 100%;">
                        💳 Подтвердить покупку
                    </button>
                </div>
            </div>
        </div>

        <!-- Экран оплаты -->
        <div class="screen" id="payment-screen">
            <button class="back-button" onclick="showScreen('purchase-screen')">
                <i class="fas fa-arrow-left"></i> Назад
            </button>
            
            <h2 style="text-align: center; margin-bottom: 20px;">💳 Оплата</h2>
            
            <div class="payment-container">
                <div class="payment-info">
                    <h3>Переведите точную сумму:</h3>
                    <div class="payment-amount" id="payment-amount">0 TON</div>
                    
                    <div class="wallet-address" id="wallet-address">
                        Загрузка адреса...
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn secondary" onclick="copyWalletAddress()">
                            📋 Скопировать адрес
                        </button>
                        <button class="action-btn secondary" onclick="openWalletApp()">
                            📱 Открыть кошелек
                        </button>
                    </div>
                    
                    <div class="payment-steps">
                        <h4>Шаги для оплаты:</h4>
                        <ol>
                            <li>Откройте ваш TON кошелек</li>
                            <li>Нажмите "Отправить"</li>
                            <li>Вставьте адрес получателя</li>
                            <li>Введите точную сумму</li>
                            <li>Подтвердите перевод</li>
                            <li>Вернитесь и нажмите "Проверить оплату"</li>
                        </ol>
                    </div>
                    
                    <div class="warning-box">
                        ⚠️ Отправляйте ТОЛЬКО TON! Другие токены не принимаются.
                        Сумма должна быть ТОЧНОЙ!
                    </div>
                    
                    <div class="action-buttons">
                        <button class="action-btn" onclick="checkPayment()" id="check-payment-btn">
                            🔄 Проверить оплату
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Экран подтверждения -->
        <div class="screen" id="confirmation-screen">
            <div class="confirmation-container">
                <div class="confirmation-icon">✅</div>
                <h2 style="text-align: center; margin-bottom: 10px;">Покупка завершена!</h2>
                <p style="text-align: center; margin-bottom: 20px; color: var(--text-secondary);">
                    Ваш подарок обрабатывается и скоро будет отправлен
                </p>
                
                <div class="confirmation-details">
                    <div class="detail-item">
                        <span>Подарок:</span>
                        <span id="confirm-gift-name">-</span>
                    </div>
                    <div class="detail-item">
                        <span>Получатель:</span>
                        <span id="confirm-username">-</span>
                    </div>
                    <div class="detail-item">
                        <span>Сумма:</span>
                        <span id="confirm-amount">- TON</span>
                    </div>
                    <div class="detail-item">
                        <span>Статус:</span>
                        <span style="color: var(--success);">Обрабатывается</span>
                    </div>
                </div>
                
                <div class="confirmation-message">
                    ⏳ Ожидайте, пока ваш подарок будет выкуплен на маркетплейсе 
                    и отправлен на ваш аккаунт. Обычно это занимает 5-15 минут.
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn" onclick="showScreen('main-screen')">
                        🏠 На главную
                    </button>
                    <button class="action-btn secondary" onclick="contactSupport()">
                        🆘 Связь с поддержкой
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Инициализация Telegram WebApp
        let tg = window.Telegram.WebApp;
        let currentUser = {
            id: tg.initDataUnsafe.user?.id || 'unknown',
            username: tg.initDataUnsafe.user?.username || 'Аноним',
            firstName: tg.initDataUnsafe.user?.first_name || 'Пользователь'
        };
        
        let currentBudget = 50;
        let selectedGift = null;
        let currentPurchaseId = null;
        let currentTheme = 'dark';
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            tg.expand();
            tg.enableClosingConfirmation();
            
            loadTheme();
            loadStatistics();
            loadUserList();
            setupEventListeners();
        });
        
        // Загрузка темы
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            currentTheme = savedTheme;
            document.body.setAttribute('data-theme', currentTheme);
        }
        
        // Переключение темы
        function switchTheme() {
            const themes = ['dark', 'light', 'purple'];
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            currentTheme = themes[nextIndex];
            
            document.body.setAttribute('data-theme', currentTheme);
            localStorage.setItem('theme', currentTheme);
            
            const btn = document.getElementById('theme-btn');
            btn.classList.add('rotating');
            setTimeout(() => btn.classList.remove('rotating'), 600);
        }
        
        // Загрузка статистики
        function loadStatistics() {
            // Обновляем основную статистику
            document.getElementById('total-users').textContent = '1,247';
            document.getElementById('today-online').textContent = '89';
            document.getElementById('daily-turnover').textContent = '2,450 TON';
            document.getElementById('gifts-sold').textContent = '156';
            
            // Обновляем админ статистику
            document.getElementById('admin-total-users').textContent = '1,247';
            document.getElementById('admin-total-sales').textContent = '543';
            document.getElementById('admin-total-revenue').textContent = '8,420 TON';
            document.getElementById('admin-active-users').textContent = '89';
        }
        
        // Загрузка списка пользователей
        function loadUserList() {
            const users = [
                { 
                    id: 1, 
                    username: '@cryptoking', 
                    firstName: 'Alex', 
                    lastName: 'Crypto', 
                    joinedDate: '2024-01-15',
                    stats: {
                        totalSpent: '1,250 TON',
                        successfulPayments: 24,
                        failedPayments: 3,
                        refundAmount: '150 TON',
                        giftsPurchased: 18,
                        topGift: 'Golden NFT',
                        avgGiftPrice: '69 TON',
                        giftsSent: 12,
                        hoursSpent: '42 ч 15 мин',
                        sessionsCount: 156,
                        supportRequests: 5,
                        daysActive: 45
                    },
                    purchaseHistory: [
                        { id: 1, date: '2024-03-15', item: 'Golden NFT', amount: '150 TON', status: 'completed' },
                        { id: 2, date: '2024-03-12', item: 'Crypto Art', amount: '85 TON', status: 'completed' },
                        { id: 3, date: '2024-03-10', item: 'VIP Badge', amount: '200 TON', status: 'cancelled' },
                        { id: 4, date: '2024-03-05', item: 'Rare Collectible', amount: '320 TON', status: 'completed' },
                        { id: 5, date: '2024-03-01', item: 'Exclusive NFT', amount: '495 TON', status: 'completed' }
                    ]
                },
                { 
                    id: 2, 
                    username: '@tonlover', 
                    firstName: 'Maria', 
                    lastName: 'Ton', 
                    joinedDate: '2024-02-03',
                    stats: {
                        totalSpent: '980 TON',
                        successfulPayments: 18,
                        failedPayments: 2,
                        refundAmount: '85 TON',
                        giftsPurchased: 14,
                        topGift: 'Crypto Art',
                        avgGiftPrice: '70 TON',
                        giftsSent: 8,
                        hoursSpent: '28 ч 40 мин',
                        sessionsCount: 98,
                        supportRequests: 2,
                        daysActive: 32
                    },
                    purchaseHistory: [
                        { id: 1, date: '2024-03-14', item: 'Crypto Art', amount: '85 TON', status: 'completed' },
                        { id: 2, date: '2024-03-08', item: 'Digital Art', amount: '120 TON', status: 'completed' }
                    ]
                },
                { 
                    id: 3, 
                    username: '@giftmaster', 
                    firstName: 'John', 
                    lastName: 'Gifts', 
                    joinedDate: '2024-01-22',
                    stats: {
                        totalSpent: '750 TON',
                        successfulPayments: 12,
                        failedPayments: 1,
                        refundAmount: '45 TON',
                        giftsPurchased: 9,
                        topGift: 'VIP Badge',
                        avgGiftPrice: '83 TON',
                        giftsSent: 6,
                        hoursSpent: '35 ч 20 мин',
                        sessionsCount: 112,
                        supportRequests: 3,
                        daysActive: 38
                    },
                    purchaseHistory: [
                        { id: 1, date: '2024-03-13', item: 'VIP Badge', amount: '200 TON', status: 'completed' },
                        { id: 2, date: '2024-03-06', item: 'Special Edition', amount: '180 TON', status: 'completed' }
                    ]
                },
                { 
                    id: 4, 
                    username: '@nftcollector', 
                    firstName: 'Sarah', 
                    lastName: 'NFT', 
                    joinedDate: '2024-03-10',
                    stats: {
                        totalSpent: '1,520 TON',
                        successfulPayments: 28,
                        failedPayments: 4,
                        refundAmount: '220 TON',
                        giftsPurchased: 22,
                        topGift: 'Rare Collectible',
                        avgGiftPrice: '69 TON',
                        giftsSent: 15,
                        hoursSpent: '51 ч 10 мин',
                        sessionsCount: 178,
                        supportRequests: 7,
                        daysActive: 52
                    },
                    purchaseHistory: [
                        { id: 1, date: '2024-03-16', item: 'Rare Collectible', amount: '320 TON', status: 'completed' },
                        { id: 2, date: '2024-03-11', item: 'Limited Edition', amount: '280 TON', status: 'completed' }
                    ]
                }
            ];
            
            const userListContainer = document.getElementById('admin-user-list');
            userListContainer.innerHTML = '';
            
            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'admin-user-item';
                userItem.setAttribute('data-user-id', user.id);
                userItem.innerHTML = `
                    <div>
                        <div style="font-weight: 600;">${user.username}</div>
                        <div style="font-size: 0.8rem; opacity: 0.7;">${user.firstName} ${user.lastName}</div>
                    </div>
                    <div style="font-size: 0.8rem; opacity: 0.7;">с ${user.joinedDate}</div>
                `;
                
                userItem.addEventListener('click', function() {
                    document.querySelectorAll('.admin-user-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    this.classList.add('active');
                    loadUserStats(user);
                });
                
                userListContainer.appendChild(userItem);
            });
        }
        
        // Загрузка статистики пользователя
        function loadUserStats(user) {
            const statsBlock = document.getElementById('user-detail-stats');
            statsBlock.style.display = 'block';
            
            document.getElementById('selected-username').textContent = user.username;
            
            // Заполнение данных статистики
            document.getElementById('user-total-spent').textContent = user.stats.totalSpent;
            document.getElementById('user-successful-payments').textContent = user.stats.successfulPayments;
            document.getElementById('user-failed-payments').textContent = user.stats.failedPayments;
            document.getElementById('user-refund-amount').textContent = user.stats.refundAmount;
            document.getElementById('user-gifts-purchased').textContent = user.stats.giftsPurchased;
            document.getElementById('user-top-gift').textContent = user.stats.topGift;
            document.getElementById('user-avg-gift-price').textContent = user.stats.avgGiftPrice;
            document.getElementById('user-gifts-sent').textContent = user.stats.giftsSent;
            document.getElementById('user-hours-spent').textContent = user.stats.hoursSpent;
            document.getElementById('user-sessions-count').textContent = user.stats.sessionsCount;
            document.getElementById('user-support-requests').textContent = user.stats.supportRequests;
            document.getElementById('user-days-active').textContent = user.stats.daysActive;
            
            // Заполнение истории покупок
            const purchaseHistoryContainer = document.getElementById('user-purchase-history');
            purchaseHistoryContainer.innerHTML = '';
            
            user.purchaseHistory.forEach(purchase => {
                const purchaseItem = document.createElement('div');
                purchaseItem.className = 'user-purchase-item';
                purchaseItem.innerHTML = `
                    <div>
                        <div style="font-weight: 600;">${purchase.item}</div>
                        <div style="font-size: 0.8rem; opacity: 0.7;">${purchase.date}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 600;">${purchase.amount}</div>
                        <div class="purchase-status ${purchase.status}">${getStatusText(purchase.status)}</div>
                    </div>
                `;
                purchaseHistoryContainer.appendChild(purchaseItem);
            });
        }
        
        // Получить текст статуса
        function getStatusText(status) {
            switch(status) {
                case 'completed': return 'Подтвержден';
                case 'cancelled': return 'Отменен';
                case 'pending': return 'В обработке';
                default: return status;
            }
        }
        
        // Фильтрация пользователей
        function filterUsers(searchTerm) {
            const userItems = document.querySelectorAll('.admin-user-item');
            
            userItems.forEach(item => {
                const username = item.querySelector('div > div:first-child').textContent.toLowerCase();
                if (username.includes(searchTerm.toLowerCase())) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }
        
        // Переключение настроек
        function toggleSetting(setting) {
            const btn = document.getElementById(`toggle-${setting}`);
            const isEnabled = btn.classList.contains('enabled');
            
            if (isEnabled) {
                btn.classList.remove('enabled');
                btn.classList.add('disabled');
                btn.textContent = btn.textContent.replace('включены', 'выключены')
                                              .replace('включен', 'выключен')
                                              .replace('онлайн', 'офлайн');
            } else {
                btn.classList.remove('disabled');
                btn.classList.add('enabled');
                btn.textContent = btn.textContent.replace('выключены', 'включены')
                                              .replace('выключен', 'включен')
                                              .replace('офлайн', 'онлайн');
            }
            
            showNotification(`Настройка "${getSettingName(setting)}" ${isEnabled ? 'выключена' : 'включена'}`, 'success');
        }
        
        // Получить название настройки
        function getSettingName(setting) {
            const names = {
                'purchases': 'Покупки',
                'sales': 'Продажи',
                'withdrawals': 'Вывод',
                'support': 'Поддержка'
            };
            return names[setting] || setting;
        }
        
        // Показать экран
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        // Показать уведомление
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Настройка слушателей событий
        function setupEventListeners() {
            // Поиск пользователей
            document.getElementById('user-search').addEventListener('input', function(e) {
                filterUsers(e.target.value);
            });
            
            // Слайдер бюджета на экране поиска
            const budgetSlider = document.getElementById('budget-slider');
            if (budgetSlider) {
                budgetSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    document.getElementById('budget-amount').textContent = value.toLocaleString();
                    currentBudget = value;
                    
                    const largeBudget = document.getElementById('large-budget');
                    if (value >= 10000) {
                        largeBudget.style.display = 'block';
                    } else {
                        largeBudget.style.display = 'none';
                    }
                });
            }
            
            // Слайдер бюджета на экране бюджета
            const budgetSetter = document.getElementById('budget-setter');
            if (budgetSetter) {
                budgetSetter.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    setBudget(value);
                });
            }
        }
        
        // Вспомогательные функции
        function setBudget(amount) {
            currentBudget = amount;
            document.getElementById('budget-setter').value = amount;
            document.getElementById('budget-display').textContent = amount.toLocaleString();
            
            const largeBudgetDisplay = document.getElementById('budget-large-display');
            if (amount >= 10000) {
                largeBudgetDisplay.style.display = 'block';
            } else {
                largeBudgetDisplay.style.display = 'none';
            }
        }
        
        function saveBudget() {
            showNotification(`Бюджет установлен: ${currentBudget.toLocaleString()} TON`);
            showScreen('main-screen');
        }
        
        function copyWalletAddress() {
            const walletAddress = document.getElementById('wallet-address').textContent;
            navigator.clipboard.writeText(walletAddress).then(() => {
                showNotification('Адрес скопирован!');
            });
        }
        
        function openWalletApp() {
            showNotification('Функция открытия кошелька в разработке');
        }
        
        function contactSupport() {
            tg.openTelegramLink('https://t.me/GiftPrisesHelperBot');
        }
        
        function connectTelegramAccount() {
            showNotification('Функция подключения аккаунта в разработке');
        }
        
        function evaluateGift() {
            showNotification('Функция оценки подарка в разработке');
        }
        
        function clearSearch() {
            document.getElementById('search-input').value = '';
            document.getElementById('backdrop-input').value = '';
            document.getElementById('symbol-input').value = '';
            document.getElementById('budget-slider').value = 50;
            document.getElementById('budget-amount').textContent = '50';
            document.getElementById('search-results').innerHTML = '<div class="loading">🔍 Введите параметры поиска...</div>';
            currentBudget = 50;
        }
        
        function loadRealGifts() {
            showScreen('catalog-screen');
            document.getElementById('catalog-content').innerHTML = '<div class="no-results">🎁 Каталог в разработке</div>';
        }
        
        function performSearch() {
            document.getElementById('search-results').innerHTML = '<div class="no-results">🔍 Функция поиска в разработке</div>';
        }
        
        function selectGift(gift) {
            showNotification('Функция выбора подарка в разработке');
        }
        
        function confirmPurchase() {
            showNotification('Функция покупки в разработке');
        }
        
        function checkPayment() {
            showNotification('Функция проверки платежа в разработке');
        }
    </script>
</body>
</html>
